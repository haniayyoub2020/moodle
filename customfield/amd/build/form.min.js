define ("core_customfield/form",["exports","core/ajax","core/str","core/inplace_editable","core/notification","core/pending","core/sortable_list","core/templates","jquery"],function(a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;d=j(d);e=j(e);f=j(f);g=j(g);h=j(h);i=j(i);function j(a){return a&&a.__esModule?a:{default:a}}var k=function(a,d,g,j,k){var l=new f.default("core_customfield/form:confirmDelete");(0,c.get_strings)([{key:"confirm"},{key:"confirmdelete"+d,component:"core_customfield"},{key:"yes"},{key:"no"}]).then(function(c){return e.default.confirm(c[0],c[1],c[2],c[3],function(){var c=new f.default("core_customfield/form:confirmDelete");(0,b.call)([{methodname:"field"===d?"core_customfield_delete_field":"core_customfield_delete_category",args:{id:a}},{methodname:"core_customfield_reload_template",args:{component:g,area:j,itemid:k}}])[1].then(function(a){return h.default.render("core_customfield/list",a)}).then(function(a,b){return h.default.replaceNode((0,i.default)("[data-region=\"list-page\"]"),a,b)}).then(c.resolve).catch(e.default.exception)})}).then(l.resolve).catch(e.default.exception)},l=function(a,c,d){var g=new f.default("core_customfield/form:confirmDelete"),j=(0,b.call)([{methodname:"core_customfield_create_category",args:{component:a,area:c,itemid:d}},{methodname:"core_customfield_reload_template",args:{component:a,area:c,itemid:d}}]);j[1].then(function(a){return h.default.render("core_customfield/list",a)}).then(function(a,b){return h.default.replaceNode((0,i.default)("[data-region=\"list-page\"]"),a,b)}).catch(e.default.exception);Promise.all(j).then(function(a){window.location.href="#category-".concat(a);return g.resolve()}).catch()},m=function(a){return a.closest("[data-category-id]").find("[data-inplaceeditable][data-itemtype=category][data-component=core_customfield]").attr("data-value")},n=function(a){var d=new g.default("#customfield_catlist .categorieslist",{moveHandlerSelector:".movecategory [data-drag-type=move]"});d.getElementName=function(a){return Promise.resolve(m(a))};(0,i.default)("[data-category-id]").on(g.default.EVENTS.DROP,function(a,c){if(c.positionChanged){var d=new f.default("core_customfield/form:categoryid:on:sortablelist-drop");(0,b.call)([{methodname:"core_customfield_move_category",args:{id:c.element.data("category-id"),beforeid:c.targetNextElement.data("category-id")}}])[0].then(d.resolve).catch(e.default.exception)}a.stopPropagation()});var j=new g.default("#customfield_catlist .fieldslist tbody",{moveHandlerSelector:".movefield [data-drag-type=move]"});j.getDestinationName=function(a,b){if(!b.length){return(0,c.get_string)("totopofcategory","customfield",m(a))}else if(b.attr("data-field-name")){return(0,c.get_string)("afterfield","customfield",b.attr("data-field-name"))}else{return Promise.resolve("")}};(0,i.default)("[data-field-name]").on(g.default.EVENTS.DROP,function(a,c){a.stopPropagation();if(c.positionChanged){var d=new f.default("core_customfield/form:fieldname:on:sortablelist-drop");(0,b.call)([{methodname:"core_customfield_move_field",args:{id:c.element.data("field-id"),beforeid:c.targetNextElement.data("field-id"),categoryid:+c.targetList.closest("[data-category-id]").attr("data-category-id")}}])[0].then(d.resolve).catch(e.default.exception)}});(0,i.default)("[data-field-name]").on(g.default.EVENTS.DRAG,function(b){var c=new f.default("core_customfield/form:fieldname:on:sortablelist-drag");b.stopPropagation();h.default.render("core_customfield/nofields",{}).then(function(b){a.querySelectorAll(".categorieslist > *").forEach(function(a){var c=a.querySelectorAll(".field:not(.sortable-list-is-dragged)"),d=a.querySelector(".nofields");if(!c.length&&!d){a.querySelector("tbody").innerHTML=b}else if(c.length&&d){d.remove()}})}).then(c.resolve).catch(e.default.exception)});(0,i.default)("[data-category-id], [data-field-name]").on(g.default.EVENTS.DRAGSTART,function(a,b){setTimeout(function(){(0,i.default)(".sortable-list-is-dragged").width(b.element.width())},501)})},o=function(){var a=document.querySelector("#customfield_catlist"),b=a.dataset.component,c=a.dataset.area,f=a.dataset.itemid;a.addEventListener("click",function(a){var d=a.target.closest("[data-role]");if(!d){return}if("deletefield"===d.dataset.role){a.preventDefault();k(d.dataset.id,"field",b,c,f);return}if("deletecategory"===d.dataset.role){a.preventDefault();k(d.dataset.id,"category",b,c,f);return}if("addnewcategory"===d.dataset.role){a.preventDefault();l(b,c,f)}});n(a,b,c,f);d.default.init()};a.init=o});
//# sourceMappingURL=form.min.js.map
